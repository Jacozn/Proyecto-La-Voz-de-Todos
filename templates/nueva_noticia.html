{% extends "base.html" %}

{% block title %}Nueva Noticia - Junta Vecinal{% endblock %}

{% block content %}
<div class="form-container">
    <h2>‚ûï Nueva Noticia</h2>
    
    <form id="noticiaForm" method="POST" enctype="multipart/form-data" class="form">
        <div class="form-group">
            <label for="titulo">üìù T√≠tulo de la Noticia:</label>
            <input type="text" id="titulo" name="titulo" required maxlength="200">
        </div>
        
        <div class="form-group">
            <label for="descripcion">üìÑ Contenido de la Noticia:</label>
            <textarea id="descripcion" name="descripcion" rows="8" required placeholder="Escribe el contenido completo de la noticia..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="imagen">üì∑ Imagen (opcional):</label>
            <input type="file" id="imagen" name="imagen" accept="image/*">
            <small>Formatos permitidos: JPG, PNG, GIF</small>
        </div>
        
        <div class="form-actions">
            <button type="button" id="btnCrearNoticia" class="btn btn-success">‚úÖ Publicar Noticia</button>
            <a href="{{ url_for('noticias') }}" class="btn btn-secondary">‚ùå Cancelar</a>
        </div>
    </form>
</div>

<!-- ‚ö†Ô∏è MODAL DE CONFIRMACI√ìN PARA NOTICIA -->
<div id="confirmModal" class="modal">
    <div class="modal-content modal-confirm">
        <div class="modal-header">
            <h3>‚ö†Ô∏è Confirmar Publicaci√≥n de Noticia</h3>
        </div>
        <div class="modal-body">
            <p>¬øEst√°s seguro de que quieres publicar esta noticia?</p>
            <div class="noticia-preview">
                <p><strong>üìù T√≠tulo:</strong> <span id="previewTitulo"></span></p>
                <p><strong>üìÑ Contenido:</strong> <span id="previewDescripcion"></span></p>
                <p id="previewImagen" style="display: none;"><strong>üì∑ Imagen:</strong> <span id="previewImagenNombre"></span></p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" id="btnConfirmarPublicacion" class="btn btn-success">‚úÖ S√≠, Publicar Noticia</button>
            <button type="button" id="btnCancelarPublicacion" class="btn btn-secondary">‚ùå Cancelar</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('noticiaForm');
    const btnCrearNoticia = document.getElementById('btnCrearNoticia');
    const confirmModal = document.getElementById('confirmModal');
    const btnConfirmarPublicacion = document.getElementById('btnConfirmarPublicacion');
    const btnCancelarPublicacion = document.getElementById('btnCancelarPublicacion');
    
    // Elementos de preview
    const previewTitulo = document.getElementById('previewTitulo');
    const previewDescripcion = document.getElementById('previewDescripcion');
    const previewImagen = document.getElementById('previewImagen');
    const previewImagenNombre = document.getElementById('previewImagenNombre');
    
    // Campos del formulario
    const titulo = document.getElementById('titulo');
    const descripcion = document.getElementById('descripcion');
    const imagen = document.getElementById('imagen');

    // ‚úÖ VALIDACI√ìN DEL FORMULARIO
    function validarFormulario() {
        if (!titulo.value.trim()) {
            alert('‚ùå Por favor, ingresa un t√≠tulo para la noticia.');
            titulo.focus();
            return false;
        }
        
        if (!descripcion.value.trim()) {
            alert('‚ùå Por favor, escribe el contenido de la noticia.');
            descripcion.focus();
            return false;
        }
        
        return true;
    }

    // üëÅÔ∏è MOSTRAR PREVIEW EN EL MODAL
    function mostrarPreview() {
        previewTitulo.textContent = titulo.value;
        
        // Limitar descripci√≥n a 200 caracteres para el preview
        const descripcionTexto = descripcion.value.length > 200 
            ? descripcion.value.substring(0, 200) + '...' 
            : descripcion.value;
        previewDescripcion.textContent = descripcionTexto;
        
        // Mostrar informaci√≥n de imagen si existe
        if (imagen.files && imagen.files[0]) {
            previewImagenNombre.textContent = imagen.files[0].name;
            previewImagen.style.display = 'block';
        } else {
            previewImagen.style.display = 'none';
        }
    }

    // üöÄ EVENTO: CREAR NOTICIA (MOSTRAR CONFIRMACI√ìN)
    btnCrearNoticia.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Validar formulario
        if (!validarFormulario()) {
            return;
        }
        
        // Mostrar preview y modal
        mostrarPreview();
        confirmModal.style.display = 'block';
    });

    // ‚úÖ EVENTO: CONFIRMAR PUBLICACI√ìN
    btnConfirmarPublicacion.addEventListener('click', function() {
        confirmModal.style.display = 'none';
        
        // Mostrar indicador de carga
        btnCrearNoticia.innerHTML = '‚è≥ Publicando Noticia...';
        btnCrearNoticia.disabled = true;
        
        // Enviar formulario
        form.submit();
    });

    // ‚ùå EVENTO: CANCELAR PUBLICACI√ìN
    btnCancelarPublicacion.addEventListener('click', function() {
        confirmModal.style.display = 'none';
    });

    // Cerrar modal al hacer clic fuera
    window.addEventListener('click', function(event) {
        if (event.target === confirmModal) {
            confirmModal.style.display = 'none';
        }
    });

    // Cerrar modal con tecla Escape
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && confirmModal.style.display === 'block') {
            confirmModal.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
